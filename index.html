<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§è¯­è§’è½</title>
    
    <!-- PWA é…ç½® -->
<link rel="manifest" href="./app.webmanifest">
<meta name="theme-color" content="#2c3e50">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ç§è¯­è§’è½">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }
        
        body {
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f5f5f5;
            transition: background 0.3s, color 0.3s;
            position: relative;
        }

        /* èƒŒæ™¯å›¾ç‰‡æ ·å¼ */
        .background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.1;
            transition: opacity 0.3s;
        }

        .background-blur {
            backdrop-filter: blur(2px);
        }

        /* æ—¥é—´/å¤œé—´æ¨¡å¼ */
        .light-mode {
            background: #f5f5f5;
            color: #333;
        }

        .dark-mode {
            background: #121212;
            color: #eee;
        }

        .dark-mode .top-bar {
            background: #1e1e1e;
            border-bottom-color: #333;
        }

        .dark-mode .user-status {
            color: #aaa;
        }

        .dark-mode .slogan {
            color: #aaa;
        }

        .dark-mode .top-btn {
            background: #2d2d2d;
            color: #aaa;
        }

        .dark-mode .top-btn:hover {
            background: #3d3d3d;
        }

        .dark-mode .other-message {
            background: #1e1e1e;
            color: #eee;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .dark-mode .chat-input {
            background: #1e1e1e;
            border-top-color: #333;
        }

        .dark-mode #message-input {
            background: #2d2d2d;
            color: #eee;
            border-color: #333;
        }

        .dark-mode .modal-content {
            background: #1e1e1e;
            color: #eee;
        }

        .dark-mode .modal-title {
            color: #eee;
        }

        .dark-mode .profile-input {
            background: #2d2d2d;
            color: #eee;
            border-color: #333;
        }

        .dark-mode .upload-btn {
            border-color: #444;
            color: #aaa;
        }

        /* é¡¶éƒ¨åŒå¤´åƒæ  */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #fff;
            border-bottom: 1px solid #eee;
            transition: background 0.3s, border-color 0.3s;
            position: relative;
            z-index: 1;
        }

        .user-card {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 4px;
            border: 2px solid #eee;
            transition: border-color 0.3s;
        }

        .dark-mode .user-avatar {
            border-color: #333;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
        }

        .user-status {
            font-size: 12px;
            color: #999;
            transition: color 0.3s;
        }

        .top-middle {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .slogan {
            font-size: 14px;
            color: #666;
            transition: color 0.3s;
        }

        .top-controls {
            display: flex;
            gap: 12px;
        }

        .top-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #f5f5f5;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #666;
            transition: background 0.3s, color 0.3s;
        }

        .top-btn:hover {
            background: #eee;
        }

        /* èŠå¤©å®¹å™¨ */
        .chat-container {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
            position: relative;
        }

        /* æ¶ˆæ¯å¸ƒå±€ */
        .message-wrapper {
            display: flex;
            align-items: flex-start;
            max-width: 85%;
            gap: 8px;
            margin-bottom: 12px;
        }

        .self-message-wrapper {
            align-self: flex-end;
            flex-direction: row;
        }

        .other-message-wrapper {
            align-self: flex-start;
            flex-direction: row;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            border: 2px solid #eee;
            transition: border-color 0.3s;
            align-self: flex-start;
            margin-top: 2px;
        }

        .dark-mode .message-avatar {
            border-color: #333;
        }

        .self-message-wrapper .message-avatar {
            order: 2;
            margin-left: 8px;
        }

        .other-message-wrapper .message-avatar {
            order: 1;
            margin-right: 8px;
        }

        .message-content-wrapper {
            display: flex;
            flex-direction: column;
            max-width: calc(100% - 50px);
            flex: 1;
        }

        .self-message-wrapper .message-content-wrapper {
            order: 1;
            align-items: flex-end;
        }

        .other-message-wrapper .message-content-wrapper {
            order: 2;
            align-items: flex-start;
        }

        .message {
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
            word-break: break-all;
            transition: background 0.3s, color 0.3s;
            max-width: 100%;
        }

        .self-message {
            border-bottom-right-radius: 4px;
        }

        .other-message {
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            transition: box-shadow 0.3s;
        }

        /* æ—¶é—´æˆ³æ ·å¼ */
        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
            padding: 0 4px;
            transition: color 0.3s;
        }

        .dark-mode .message-time {
            color: #aaa;
        }

        /* æ’¤å›æŒ‰é’® */
        .recall-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            font-size: 9px;
            padding: 1px 4px;
            background: rgba(0,0,0,0.2);
            color: #fff;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            display: none;
        }

        .message:hover .recall-btn {
            display: block;
        }

        .recalled-message {
            font-style: italic;
            opacity: 0.6;
        }

        /* è¾“å…¥æ¡† */
        .chat-input {
            padding: 12px 16px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            background: #fff;
            transition: background 0.3s, border-color 0.3s;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .input-btns {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        #message-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 24px;
            background: #f5f5f5;
            color: #333;
            font-size: 16px;
            outline: none;
            transition: background 0.3s, color 0.3s, border-color 0.3s;
        }

        #send-btn, #quick-reply-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }

        #send-btn {
            background: #2c3e50;
            color: #fff;
        }

        #send-btn:hover {
            background: #34495e;
        }

        #quick-reply-btn {
            background: #f5f5f5;
            color: #333;
        }

        .dark-mode #quick-reply-btn {
            background: #2d2d2d;
            color: #eee;
        }

        #quick-reply-btn:hover {
            background: #eee;
        }

        .dark-mode #quick-reply-btn:hover {
            background: #3d3d3d;
        }

        /* å¼¹çª—é€šç”¨æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: #fff;
            padding: 24px;
            border-radius: 16px;
            width: 90%;
            max-width: 450px;
            text-align: center;
            transition: background 0.3s, color 0.3s;
        }

        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            transition: color 0.3s;
        }

        .modal-btn {
            padding: 12px 28px;
            border: none;
            border-radius: 24px;
            background: #2c3e50;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 8px;
            margin-top: 20px;
            transition: background 0.3s;
        }

        .modal-btn.cancel {
            background: #f5f5f5;
            color: #333;
        }

        .dark-mode .modal-btn.cancel {
            background: #2d2d2d;
            color: #eee;
        }

        /* æ°”æ³¡è‡ªå®šä¹‰æ ·å¼ */
        .bubble-custom-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }

        .color-picker-wrap {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
        }

        .color-picker-wrap label {
            font-size: 14px;
            color: #666;
            transition: color 0.3s;
        }

        .dark-mode .color-picker-wrap label {
            color: #aaa;
        }

        .color-picker {
            width: 100%;
            height: 40px;
            border: none;
            background: transparent;
            cursor: pointer;
        }

        /* å¤´åƒ/çŠ¶æ€è®¾ç½®æ ·å¼ */
        .profile-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin: 20px 0;
        }

        .profile-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 24px;
            background: #f5f5f5;
            color: #333;
            font-size: 16px;
            outline: none;
            transition: background 0.3s, color 0.3s, border-color 0.3s;
        }

        .upload-btn {
            display: inline-block;
            padding: 10px 16px;
            border: 1px dashed #ccc;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px 0;
            font-size: 14px;
            color: #666;
            transition: border-color 0.3s, color 0.3s;
        }

        .upload-input {
            display: none;
        }

        .preview-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 10px auto;
            display: block;
            border: 1px solid #eee;
            transition: border-color 0.3s;
        }

        .dark-mode .preview-img {
            border-color: #444;
        }

        /* æ»šåŠ¨åˆ°é¡¶éƒ¨æŒ‰é’® */
        .scroll-top-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: #fff;
            color: #333;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .dark-mode .scroll-top-btn {
            background: #333;
            color: #eee;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .scroll-top-btn:hover {
            background: #f5f5f5;
            transform: scale(1.05);
        }

        .dark-mode .scroll-top-btn:hover {
            background: #444;
        }

        /* èƒŒæ™¯è®¾ç½®æ ·å¼ */
        .background-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin: 20px 0;
        }

        .background-preview {
            width: 100%;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
            display: none;
        }

        .background-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .opacity-slider {
            flex: 1;
        }

        .blur-toggle {
            padding: 8px 16px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            background: #f5f5f5;
            cursor: pointer;
            transition: all 0.3s;
        }

        .blur-toggle.active {
            background: #2c3e50;
            color: white;
        }

        /* ç®¡ç†åŠŸèƒ½åŒºåŸŸæ ·å¼ */
        .management-options {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .management-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .management-btn {
            padding: 12px 20px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: #f8f9fa;
            color: #333;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .management-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .dark-mode .management-btn {
            background: #2d2d2d;
            border-color: #444;
            color: #eee;
        }

        .dark-mode .management-btn:hover {
            background: #3d3d3d;
        }

        .management-title {
            font-size: 16px;
            font-weight: 600;
            color: #666;
            margin-bottom: 10px;
            text-align: center;
        }

        .dark-mode .management-title {
            color: #aaa;
        }

        /* ç©ºçŠ¶æ€æç¤º */
        .empty-state {
            text-align: center;
            color: #999;
            padding: 50px 20px;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-state-subtext {
            font-size: 14px;
        }

        /* å›å¤ç®¡ç†ç›¸å…³æ ·å¼ */
        .reply-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
        }

        .dark-mode .reply-item {
            background: #2d2d2d;
            border-color: #444;
            color: #eee;
        }

        .reply-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .dark-mode .reply-item:hover {
            background: #3d3d3d;
        }

        .reply-content {
            flex: 1;
            padding-right: 10px;
            word-break: break-all;
            font-size: 14px;
        }

        .reply-actions {
            display: flex;
            gap: 8px;
        }

        .reply-action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reply-edit-btn {
            background: #3498db;
            color: white;
        }

        .reply-edit-btn:hover {
            background: #2980b9;
        }

        .reply-delete-btn {
            background: #e74c3c;
            color: white;
        }

        .reply-delete-btn:hover {
            background: #c0392b;
        }

        .add-reply-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .dark-mode .add-reply-section {
            border-top-color: #444;
        }

        #new-reply-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f5f5f5;
            color: #333;
        }

        .dark-mode #new-reply-input {
            background: #2d2d2d;
            border-color: #444;
            color: #eee;
        }

        #add-reply-btn {
            width: 100%;
            padding: 10px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        #add-reply-btn:hover {
            background: #219a52;
        }

        .empty-replies {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-style: italic;
        }
    </style>
</head>
<body class="light-mode">
    <!-- èƒŒæ™¯å›¾ç‰‡ -->
    <img id="background-image" class="background-image" src="" alt="èƒŒæ™¯å›¾ç‰‡" style="display: none;">
    
    <!-- é¡¶éƒ¨åŒå¤´åƒæ  -->
    <div class="top-bar">
        <div class="user-card">
            <img src="https://picsum.photos/id/1/200" class="user-avatar" id="self-avatar-display">
            <div class="user-name" id="self-name-display">æ˜µç§°</div>
            <div class="user-status" id="self-status-display">çŠ¶æ€</div>
        </div>
        <div class="top-middle">
            <div class="slogan" id="slogan-display">è¯·ç¼–è¾‘</div>
            <div class="top-controls">
                <button class="top-btn" id="mode-toggle"><span>ğŸŒ™</span></button>
                <button class="top-btn" id="settings-toggle"><span>âš™ï¸</span></button>
            </div>
        </div>
        <div class="user-card">
            <img src="https://picsum.photos/id/2/200" class="user-avatar" id="other-avatar-display">
            <div class="user-name" id="other-name-display">ä»–çš„æ˜µç§°</div>
            <div class="user-status" id="other-status-display">ä»–çš„çŠ¶æ€</div>
        </div>
    </div>

    <!-- èŠå¤©å®¹å™¨ -->
    <div class="chat-container" id="chat-container">
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ’¬</div>
            <div class="empty-state-text">è¿˜æ²¡æœ‰æ¶ˆæ¯</div>
            <div class="empty-state-subtext">å‘é€ä¸€æ¡æ¶ˆæ¯å¼€å§‹èŠå¤©å§ï¼</div>
        </div>
    </div>

    <!-- è¾“å…¥æ¡† -->
    <div class="chat-input">
        <button class="scroll-top-btn" id="scroll-top-btn" title="å›åˆ°é¡¶éƒ¨">â†‘</button>
        <input type="text" id="message-input" placeholder="è¾“å…¥æ¶ˆæ¯..." autocomplete="off">
        <div class="input-btns">
            <button id="quick-reply-btn">ä¸€é”®å›å¤</button>
            <button id="send-btn">å‘é€</button>
        </div>
    </div>

    <!-- è®¾ç½®å¼¹çª— -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <h3 class="modal-title">ä¸ªäººè®¾ç½®</h3>
            <div class="profile-options">
                <div>
                    <label style="font-size: 14px; color: #666;">è‡ªå·±çš„æ˜µç§°</label>
                    <input type="text" class="profile-input" id="self-name-input" placeholder="è¾“å…¥æ˜µç§°...">
                </div>
                <div>
                    <label style="font-size: 14px; color: #666;">è‡ªå·±çš„çŠ¶æ€</label>
                    <input type="text" class="profile-input" id="self-status-input" placeholder="è¾“å…¥çŠ¶æ€...">
                </div>
                <div>
                    <label class="upload-btn" for="self-avatar-upload">ä¸Šä¼ è‡ªå·±çš„å¤´åƒ</label>
                    <input type="file" id="self-avatar-upload" class="upload-input" accept="image/*">
                    <img id="self-avatar-preview" class="preview-img" src="" alt="é¢„è§ˆå›¾" style="display: none;">
                </div>
                <div>
                    <label style="font-size: 14px; color: #666;">å¯¹æ–¹çš„æ˜µç§°</label>
                    <input type="text" class="profile-input" id="other-name-input" placeholder="è¾“å…¥æ˜µç§°...">
                </div>
                <div>
                    <label style="font-size: 14px; color: #666;">å¯¹æ–¹çš„çŠ¶æ€</label>
                    <input type="text" class="profile-input" id="other-status-input" placeholder="è¾“å…¥çŠ¶æ€...">
                </div>
                <div>
                    <label class="upload-btn" for="other-avatar-upload">ä¸Šä¼ å¯¹æ–¹çš„å¤´åƒ</label>
                    <input type="file" id="other-avatar-upload" class="upload-input" accept="image/*">
                    <img id="other-avatar-preview" class="preview-img" src="" alt="é¢„è§ˆå›¾" style="display: none;">
                </div>
                <div>
                    <label style="font-size: 14px; color: #666;">ä¸­é—´æ ‡è¯­</label>
                    <input type="text" class="profile-input" id="slogan-input" placeholder="è¾“å…¥æ ‡è¯­...">
                </div>
            </div>

            <!-- ç®¡ç†åŠŸèƒ½åŒºåŸŸ -->
            <div class="management-options">
                <div class="management-title">èŠå¤©ç®¡ç†</div>
                <div class="management-buttons">
                    <button class="management-btn" id="export-btn">ğŸ“¥ å¯¼å‡ºèŠå¤©è®°å½•</button>
                    <button class="management-btn" id="clear-btn">ğŸ—‘ï¸ æ¸…ç©ºèŠå¤©è®°å½•</button>
                    <button class="management-btn" id="background-btn">ğŸ¨ èƒŒæ™¯è®¾ç½®</button>
                </div>
            </div>

            <!-- å›å¤å†…å®¹ç®¡ç† -->
            <div class="management-options">
                <div class="management-title">å›å¤å†…å®¹ç®¡ç†</div>
                <div class="management-buttons">
                    <button class="management-btn" id="manage-replies-btn">ğŸ“ ç®¡ç†å›å¤å†…å®¹</button>
                </div>
            </div>

            <button class="modal-btn" id="save-profile">ä¿å­˜å¹¶è®¾ç½®æ°”æ³¡</button>
            <button class="modal-btn cancel" id="close-settings">å…³é—­</button>
        </div>
    </div>

    <!-- æ°”æ³¡è‡ªå®šä¹‰å¼¹çª— -->
    <div class="modal" id="bubble-modal">
        <div class="modal-content">
            <h3 class="modal-title">è‡ªå®šä¹‰æ°”æ³¡æ ·å¼</h3>
            <div class="bubble-custom-options">
                <div class="color-picker-wrap">
                    <label>è‡ªå·±çš„æ°”æ³¡é¢œè‰²</label>
                    <input type="color" class="color-picker" id="self-bubble-color" value="#2c3e50">
                </div>
                <div class="color-picker-wrap">
                    <label>è‡ªå·±çš„æ°”æ³¡æ–‡å­—é¢œè‰²</label>
                    <input type="color" class="color-picker" id="self-text-color" value="#ffffff">
                </div>
                <div class="color-picker-wrap">
                    <label>å¯¹æ–¹çš„æ°”æ³¡é¢œè‰²</label>
                    <input type="color" class="color-picker" id="other-bubble-color" value="#ffffff">
                </div>
                <div class="color-picker-wrap">
                    <label>å¯¹æ–¹çš„æ°”æ³¡æ–‡å­—é¢œè‰²</label>
                    <input type="color" class="color-picker" id="other-text-color" value="#333333">
                </div>
            </div>
            <button class="modal-btn" id="save-bubble">åº”ç”¨æ ·å¼</button>
            <button class="modal-btn cancel" id="close-bubble">å…³é—­</button>
        </div>
    </div>

    <!-- èƒŒæ™¯è®¾ç½®å¼¹çª— -->
    <div class="modal" id="background-modal">
        <div class="modal-content">
            <h3 class="modal-title">èƒŒæ™¯è®¾ç½®</h3>
            <div class="background-options">
                <div>
                    <label class="upload-btn" for="background-upload">ä¸Šä¼ èƒŒæ™¯å›¾ç‰‡</label>
                    <input type="file" id="background-upload" class="upload-input" accept="image/*">
                    <img id="background-preview" class="background-preview" src="" alt="èƒŒæ™¯é¢„è§ˆ">
                </div>
                <div>
                    <label style="font-size: 14px; color: #666;">èƒŒæ™¯é€æ˜åº¦</label>
                   <input type="range" class="opacity-slider" id="background-opacity" min="0.1" max="1.0" step="0.1" value="0.1">
                    <span id="opacity-value">10%</span>
                </div>
                <div class="background-controls">
                    <button class="blur-toggle" id="blur-toggle">æ¨¡ç³Šæ•ˆæœ: å…³é—­</button>
                    <button class="modal-btn cancel" id="reset-background">é‡ç½®èƒŒæ™¯</button>
                </div>
            </div>
            <button class="modal-btn" id="save-background">ä¿å­˜èƒŒæ™¯</button>
            <button class="modal-btn cancel" id="close-background">å…³é—­</button>
        </div>
    </div>

    <!-- å›å¤å†…å®¹ç®¡ç†å¼¹çª— -->
    <div class="modal" id="replies-modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3 class="modal-title">ç®¡ç†å›å¤å†…å®¹</h3>
            
            <!-- æ·»åŠ æ–°å›å¤ -->
            <div class="add-reply-section">
                <input type="text" id="new-reply-input" placeholder="è¾“å…¥æ–°çš„å›å¤å†…å®¹..." maxlength="100">
                <button id="add-reply-btn">â• æ·»åŠ å›å¤</button>
            </div>
            
            <!-- å›å¤åˆ—è¡¨ -->
            <div class="replies-list" id="replies-list" style="max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px; margin: 15px 0;">
                <!-- å›å¤å†…å®¹å°†åŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
            </div>
            
            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div style="font-size: 12px; color: #666; margin-top: 10px; text-align: center;">
                å…± <span id="replies-count">0</span> æ¡å›å¤å†…å®¹
            </div>
            
            <div style="margin-top: 20px;">
                <button class="modal-btn" id="save-replies">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>
                <button class="modal-btn cancel" id="close-replies">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // æ³¨å†Œ Service Worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./sw.js')
      .then(function(registration) {
        console.log('ServiceWorker æ³¨å†ŒæˆåŠŸ: ', registration.scope);
      })
      .catch(function(err) {
        console.log('ServiceWorker æ³¨å†Œå¤±è´¥: ', err);
      });
  });
}

// æ£€æµ‹æ˜¯å¦ä»ä¸»å±å¹•å¯åŠ¨
window.addEventListener('load', function() {
  if (window.matchMedia('(display-mode: standalone)').matches) {
    console.log('ä»ä¸»å±å¹•å¯åŠ¨ - ç‹¬ç«‹æ¨¡å¼');
    document.body.classList.add('pwa-mode');
  }
});
        
        // å…ƒç´ è·å–
        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const quickReplyBtn = document.getElementById('quick-reply-btn');
        const modeToggle = document.getElementById('mode-toggle');
        const settingsToggle = document.getElementById('settings-toggle');
        const settingsModal = document.getElementById('settings-modal');
        const selfNameInput = document.getElementById('self-name-input');
        const selfStatusInput = document.getElementById('self-status-input');
        const selfAvatarUpload = document.getElementById('self-avatar-upload');
        const selfAvatarPreview = document.getElementById('self-avatar-preview');
        const selfAvatarDisplay = document.getElementById('self-avatar-display');
        const selfNameDisplay = document.getElementById('self-name-display');
        const selfStatusDisplay = document.getElementById('self-status-display');
        const otherNameInput = document.getElementById('other-name-input');
        const otherStatusInput = document.getElementById('other-status-input');
        const otherAvatarUpload = document.getElementById('other-avatar-upload');
        const otherAvatarPreview = document.getElementById('other-avatar-preview');
        const otherAvatarDisplay = document.getElementById('other-avatar-display');
        const otherNameDisplay = document.getElementById('other-name-display');
        const otherStatusDisplay = document.getElementById('other-status-display');
        const sloganInput = document.getElementById('slogan-input');
        const sloganDisplay = document.getElementById('slogan-display');
        const saveProfile = document.getElementById('save-profile');
        const closeSettings = document.getElementById('close-settings');
        const bubbleModal = document.getElementById('bubble-modal');
        const selfBubbleColor = document.getElementById('self-bubble-color');
        const selfTextColor = document.getElementById('self-text-color');
        const otherBubbleColor = document.getElementById('other-bubble-color');
        const otherTextColor = document.getElementById('other-text-color');
        const saveBubble = document.getElementById('save-bubble');
        const closeBubble = document.getElementById('close-bubble');
        const clearBtn = document.getElementById('clear-btn');
        const exportBtn = document.getElementById('export-btn');
        const scrollTopBtn = document.getElementById('scroll-top-btn');
        const backgroundBtn = document.getElementById('background-btn');
        const backgroundModal = document.getElementById('background-modal');
        const backgroundUpload = document.getElementById('background-upload');
        const backgroundPreview = document.getElementById('background-preview');
        const backgroundImage = document.getElementById('background-image');
        const backgroundOpacity = document.getElementById('background-opacity');
        const opacityValue = document.getElementById('opacity-value');
        const blurToggle = document.getElementById('blur-toggle');
        const resetBackground = document.getElementById('reset-background');
        const saveBackground = document.getElementById('save-background');
        const closeBackground = document.getElementById('close-background');
        
        // å›å¤ç®¡ç†ç›¸å…³å…ƒç´ 
        const manageRepliesBtn = document.getElementById('manage-replies-btn');
        const repliesModal = document.getElementById('replies-modal');
        const repliesList = document.getElementById('replies-list');
        const repliesCount = document.getElementById('replies-count');
        const saveReplies = document.getElementById('save-replies');
        const closeReplies = document.getElementById('close-replies');
        const newReplyInput = document.getElementById('new-reply-input');
        const addReplyBtn = document.getElementById('add-reply-btn');

        // éŸ³æ•ˆ
        const sendSound = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');
        const receiveSound = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==');

        // åˆå§‹é…ç½®
        const defaultConfig = {
            selfName: 'æ˜µç§°',
            selfStatus: 'çŠ¶æ€',
            selfAvatar: 'https://picsum.photos/id/1/200',
            otherName: 'ä»–çš„æ˜µç§°',
            otherStatus: 'ä»–çš„çŠ¶æ€',
            otherAvatar: 'https://picsum.photos/id/2/200',
            slogan: 'è¯·ç¼–è¾‘',
            selfBubbleColor: '#2c3e50',
            selfTextColor: '#ffffff',
            otherBubbleColor: '#ffffff',
            otherTextColor: '#333333',
            isDarkMode: false,
            backgroundImage: '',
            backgroundOpacity: 0.1,
            backgroundBlur: false,
            soundEnabled: true
        };

        let config = JSON.parse(localStorage.getItem('chatConfig')) || defaultConfig;

        // å®Œæ•´å›å¤åº“
const replies = [
    // é—®å€™å¯’æš„
    "æ—©ä¸Šå¥½", "ä¸­åˆå¥½", "æ™šä¸Šå¥½", "åœ¨å—ï¼Ÿ", "æ™šå®‰", "å¥½æ¢¦", "æ—©ç‚¹ç¡", "å†è§",
    "æœ€è¿‘è¿˜å¥½å—ï¼Ÿ", "ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ", "è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿ", "çœ‹åˆ°è®°å¾—å›å¤",

    // å›åº”ä¸ç¡®è®¤
    "å¥½çš„", "æ˜ç™½", "æˆ‘æ˜ç™½äº†", "å¬æ‡‚äº†", "æ”¶åˆ°", "è®°ä¸‹äº†", "äº†è§£", "OK",
    "æ²¡é—®é¢˜", "å½“ç„¶", "ç¡®å®", "æ²¡é”™", "å¥½å‘€", "å¥½å“¦", "å—¯", "å—¯å—¯", "å—¯å“¼",
    "å“¼å“¼", "æ˜¯çš„", "ä¸æ˜¯", "æ˜¯", "å¦", "å¯ä»¥", "ä¸å¯ä»¥", "åŒæ„", "æˆ‘åŒæ„",
    "æˆ‘ä¸åŒæ„", "ç†è§£", "ç›¸ä¿¡ä½ ", "æˆ‘ç›¸ä¿¡ä½ ", "è‡ªä¿¡äº›", "ç›¸ä¿¡è‡ªå·±", "æˆ‘ä¸ä¿¡",
    "ä½ æ²¡åœ¨éª—æˆ‘å§ï¼Ÿ", "æ²¡éª—ä½ ", "æˆ‘æ²¡æœ‰åœ¨æ¬ºéª—ä½ ", "åˆ«ç›¸ä¿¡", "å¦‚æœæˆ‘è¯´æ˜¯å‘¢",
    "å¦‚æœæˆ‘è¯´ä¸æ˜¯å‘¢", "ä½ è¯´å¾—å¯¹", "æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„", "ä¸€æ ·çš„",

    // æƒ…æ„Ÿè¡¨è¾¾
    "å–œæ¬¢", "ä¸å–œæ¬¢", "æˆ‘å–œæ¬¢", "å–œæ¬¢ä½ ", "æˆ‘çˆ±ä½ ", "çˆ±ä½ ", "æˆ‘å–œæ¬¢ä½ ", "æƒ³ä½ ",
    "å¥½æƒ³è§ä½ ", "ä»Šå¤©æˆ‘å¾ˆæƒ³ä½ ", "æƒ³æˆ‘äº†å—ï¼Ÿ", "ä½ æƒ³æˆ‘äº†å—ï¼Ÿ", "å¤šçˆ±æˆ‘ä¸€ç‚¹",
    "ä½ æ˜¯æˆ‘çš„", "æˆ‘æ˜¯ä½ çš„", "ä½ æ— äººå¯åŠ", "æˆ‘æ— äººå¯åŠ", "ä½ æ˜¯å”¯ä¸€",
    "åœ¨æˆ‘è¿™é‡Œä½ å°±æ˜¯æœ€å¥½çš„", "æ°¸è¿œåœ¨ä¸€èµ·", "å’Œæˆ‘æ°¸è¿œåœ¨ä¸€èµ·",
    "æ­¤åˆ»æˆ‘æƒ³å’Œä½ æ°¸è¿œåœ¨ä¸€èµ·", "ä»–æœè‹¥æ˜¯åŒæ·‹é›ªï¼Œæ­¤ç”Ÿä¹Ÿç®—å…±ç™½å¤´",
    "æ€œæ‚¯æˆ‘ï¼Œç„¶åçˆ±æˆ‘å§", "æ’’å¨‡ï¼Œä½ ä¼šå–œæ¬¢å—ï¼Ÿ", "æ’’ä¸ªå¨‡ï¼Œç†ç†æˆ‘ï¼Ÿ", "åƒé†‹",
    "æˆ‘åƒé†‹äº†", "åƒé†‹æ€ä¹ˆäº† å°±çˆ±åƒé†‹ï¼", "å¼€å¿ƒ", "å¥½å¼€å¿ƒ", "å¿«ä¹", "å¹¸ç¦",
    "å¥½å¹¸ç¦", "æƒŠè®¶", "å®³ç¾", "å¯çˆ±", "å¥½å¯çˆ±", "å¸…æ°”", "æ°´çµçµçš„ã€æˆ‘å–œæ¬¢çš„ã€æœ€å¥½çš„ä½ ",
    "å¾ˆè½¯ï¼Œå¾ˆæ¼‚äº®", "æˆ‘å¥½å¿ƒç–¼", "æˆ‘å¥½éš¾è¿‡", "éš¾è¿‡", "ä¼¤å¿ƒ", "ä¸é«˜å…´", "ä¸å¼€å¿ƒ",
    "æˆ‘ç”Ÿæ°”äº†", "ç”Ÿæ°”", "è®¨åŒ", "å¥½çƒ¦", "æ— èŠ", "å¥½ç´¯", "ç´¯", "ç—›ç—›", "è¢«å“åˆ°äº†ï¼Ÿ",
    "æˆ‘å¾ˆéš¾è¿‡", "æˆ‘è¦å“­äº†ï¼", "çœ¼èŠ±ç¼­ä¹±äº†", "å¾ˆæœ‰åˆ›æ„", "ä¸é”™", "è¿˜ä¸é”™", "å¾ˆå¥½",
    "è¿™ä¸ªæ¶ˆæ¯ä¸é”™", "æœŸå¾…", "å“ˆå“ˆå“ˆå“ˆ", "å¼€å¿ƒ(*^â–½^*)", "å¥½å•Š^_^",

    // äº’åŠ¨åŠ¨ä½œä¸äº²å¯†è¡¨è¾¾
    "æ‘¸å¤´", "ç‰µæ‰‹", "æŠ±æŠ±", "å»", "æ‘¸è„¸", "äº²äº²(*^3^)", "è´´è´´", "æˆ³æˆ³",
    "ææåé¢ˆ", "ææè€³å‚", "åæŒ‡ç›¸æ‰£", "æ‘¸æ‘¸", "æƒ³è§¦ç¢°ä½ ", "æƒ³è¦äº²äº²",
    "æƒ³è¦æ›´è¿‘ä¸€æ­¥åœ°è´´è´´", "æˆ‘æƒ³é è¿‘ä½ ", "å¥½æƒ³æ‹¥æŠ±ä½ ", "ç²˜äººç²¾", "å¥½é»äºº",

    // æ—¥å¸¸çŠ¶æ€ä¸è¡Œä¸º
    "æˆ‘åœ¨", "åœ¨", "ä¸åœ¨", "åœ¨å·¥ä½œ", "å·¥ä½œ", "è¿˜åœ¨å¿™", "åœ¨å¿™", "ä¸å¿™", "æœ‰ç©º",
    "ä½ æ‰¾æˆ‘æˆ‘å°±æœ‰ç©º", "æˆ‘ç°åœ¨ä¸å¿™ï¼Œæœ‰ç©ºçš„", "ä½ ç°åœ¨å¿™å—ï¼Ÿ", "åœ¨å­¦ä¹ ",
    "åœ¨å­¦ä¹ å—ï¼Ÿ", "åœ¨å­¦ä¹ ä¸€äº›æ–°ä¸œè¥¿", "åœ¨åŠªåŠ›äº†", "æˆ‘åœ¨åŠªåŠ›", "æ­£åœ¨åŠªåŠ›",
    "åœ¨æ¢ç´¢è¿‡ç¨‹ä¸­", "å¯»æ‰¾ä¸­", "åœ¨ç£¨åˆ", "åœ¨å°è¯•æ§åˆ¶äº†", "å’Œä»£ç ææ–—ä¸­ï¼",
    "æ­£åœ¨æ‰“æ¶", "æ­£åœ¨ç†¬å¤œ", "å¤±çœ äº†", "æƒŠé†’äº†ï¼Œç¡ä¸ç€", "ä½œæ¯æ··ä¹±", "ç¡è§‰",
    "ä¸€èµ·ç¡è§‰", "å‡†å¤‡ç¡è§‰", "åœ¨çœ‹ä»€ä¹ˆï¼Ÿ", "çœ‹æ‰‹æœº", "åˆ«çœ‹å°çº¢ä¹¦äº†", "åˆ«çœ‹æŠ–éŸ³äº†",
    "ä¸Šæ¸¸æˆ", "åœ¨å–é…’", "å–æ°´", "å–é¥®æ–™", "å–é…’", "è°ƒé…’", "æ³¡æ¾¡", "æ¸¸æ³³",
    "æ´—æ¾¡", "æ´—è¡£æœ", "åšé¥­", "åƒé¥­", "åƒæ°´æœ", "å’Œæˆ‘åƒè‹¹æœ", "åƒè‹¹æœ", "å¥½åƒ",
    "ä¸å¥½åƒ", "å¥½åƒçˆ±åƒ", "ä¸‹åˆèŒ¶", "å—¯ï¼Œåƒçš„æ˜¯ä¸»é£Ÿ", "æœ‰ç‚¹é¥¿", "æƒ³åƒ",
    "æƒ³åƒä»€ä¹ˆï¼Ÿ", "æƒ³åƒä½ åšçš„é¥­", "åƒè¿‡äº†", "è¿˜æ²¡åƒ", "è®°å¾—åƒé¥­", "å¥½å¥½åƒé¥­",
    "å°‘åƒå¤–å–", "åˆ«è´ªå‡‰", "ç©¿åšç‚¹", "å¤šç©¿ç‚¹è¡£æœ", "æœ€è¿‘å¤©å‡‰äº†", "å¤šåŠ äº›è¡£æœ",
    "å¤©æ°”å˜çƒ­äº†", "æœ‰ç‚¹å†·", "æœ‰ç‚¹çƒ­", "å¾ˆçƒ­å—ï¼Ÿå¿ä¸€å¿", "è¦ä¸‹é›¨äº†", "ä¸‹é›¨äº†",
    "å¤©æ™´äº†", "ä¸‹é›ªäº†", "ä»Šå¤©çš„å¤©æ°”ä¸é”™", "æœ€è¿‘å¤©å‡‰äº†", "é‡‡è´­", "èµšé’±èµšé’±",
    "æ¯æ—¥è¡Œä¸€å–„", "å¸®ä½ æ‰æ‰", "èµ°è·¯ä¸è¦çœ‹æ‰‹æœº", "å°å¿ƒäº›", "å°å¿ƒç‚¹", "å°å¿ƒå—ä¼¤",
    "å°å¿ƒç”Ÿç—…", "åˆ«ç”Ÿç—…", "ä¸èˆ’æœï¼Ÿ", "è‚šå­ç–¼ï¼Ÿå¸®ä½ æ‰æ‰", "å¤šå–æ°´å“¦", "ç…§é¡¾å¥½è‡ªå·±",
    "å¥½å¥½ç…§é¡¾è‡ªå·±", "å¥½å¥½ä¼‘æ¯", "ä¼‘æ¯", "ä¸æƒ³å·¥ä½œ", "å‡ºå»é€é€æ°”", "æƒ³å’Œä½ ä¸€èµ·å¬æ­Œ",
    "å¬éŸ³ä¹", "çœ‹ä¹¦", "åšé¥­", "æ´—è¡£æœ", "å»æ”¶æ‹¾æˆ¿é—´", "è‡ªå·±åš", "åšå®¶åŠ¡", "é‡‡è´­",
    "åº”é…¬", "ç¦»å®¶å‡ºèµ°", "æ­£åœ¨è·¯ä¸Š", "æ¥äº†", "æ¥äº†æ¥äº†", "é©¬ä¸Šæ¥", "é©¬ä¸Š",
    "é©¬ä¸Šå›å®¶", "æˆ‘åˆ°å®¶äº†", "åç­‰å›å¤", "ç»ˆäºæƒ³èµ·æˆ‘äº†", "ç»ˆäºæƒ³èµ·æˆ‘äº†ï¼Ÿ",
    "å‡ å¤©ä¹‹å", "å‡ ä¸ªå°æ—¶å", "å¾ˆä¹…ä¹‹å", "è¿˜è¦ä¸€ä¼šå„¿", "è¦å¾ˆæ™š", "ç¨åå›å¤ä½ ",
    "ä¼šå°½å¿«æŸ¥çœ‹çš„", "è®©æˆ‘ç¡®è®¤ä¸€ä¸‹ä¿¡æ¯å†ç»™ä½ å‡†ç¡®ç­”å¤", "ä¿¡å·ä¸å¤ªå¥½ï¼Œå¯èƒ½å›å¤ä¼šå»¶è¿Ÿ",
    "æˆ‘æ­£åœ¨å¿™ï¼Œç¨åå›å¤ä½ ", "åœ¨äº¤æ›¿å›å¤", "é¢ é¸¾å€’å‡¤", "é±¼æ°´ä¹‹æ¬¢",

    // æ²Ÿé€šä¸å›åº”
    "æ€ä¹ˆäº†ï¼Ÿ", "æ€ä¹ˆå•¦ï¼", "æ€ä¹ˆäº†ï¼Ÿ", "çœŸçš„å—ï¼Ÿ", "å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ",
    "æ˜¯ä»€ä¹ˆäº‹è®©ä½ è¿™ä¹ˆé«˜å…´", "ä½ å¾…ä¼šæœ‰ä»€ä¹ˆå®‰æ’ï¼Ÿ", "ä½ æœ€è¿‘åœ¨å¿™äº›ä»€ä¹ˆå‘¢ï¼Ÿ",
    "é‡åˆ°å›°éš¾äº†", "æœ‰ä»€ä¹ˆè®¡åˆ’å—ï¼Ÿ", "ä½ æœ‰ä»€ä¹ˆè®¡åˆ’å—ï¼Ÿ", "æ¥ä¸‹æ¥å‡†å¤‡åšä»€ä¹ˆï¼Ÿ",
    "ç„¶åå‘¢ï¼Ÿ", "è¿˜æœ‰å‘¢ï¼Ÿ", "å†æŠ½ä¸€å¼ ", "å†å‘ä¸€é", "å‘Šè¯‰æˆ‘æ›´å¤š", "ä½ è¯´", "æˆ‘åœ¨å¬",
    "å¤šè·Ÿæˆ‘è¯´è¯", "èŠèŠå¤©å§", "èŠä¼šå„¿å¤©", "ä¿æŒè”ç³»", "å’Œæˆ‘ä¸€èµ·", "é™ªæˆ‘", "æˆ‘é™ªä½ ",
    "åˆ«èµ°", "é™ªé™ªæˆ‘", "åˆ«èµ°ï¼Œé™ªé™ªæˆ‘", "æˆ‘ä¼šåœ¨ä½ èº«è¾¹", "æˆ‘ä¼šé™ªä¼´åœ¨ä½ èº«è¾¹", "æˆ‘ä¼šçœ‹ç€ä½ çš„",
    "æˆ‘ä¼šç›‘ç£ä½ çš„", "æˆ‘å®ˆç€ä½ ", "æˆ‘ä¿æŠ¤ä½ ", "æœ‰æˆ‘åœ¨", "åˆ«æ€•", "åˆ«æ‹…å¿ƒ", "é‚£äº›æ˜¯å‡è±¡",
    "ä¸è¦æ‹…å¿ƒ", "ä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„", "æ²¡å…³ç³»", "å¯¹ä¸èµ·", "æŠ±æ­‰", "åŸè°…æˆ‘å§",
    "ä¸ç”¨æ„Ÿåˆ°æŠ±æ­‰", "è¯¯ä¼šæˆ‘äº†", "ä¸æ˜¯è¿™ä¸ªæ„æ€", "è¯éæœ¬æ„", "ä½ æ²¡æœ‰æ­£é¢å›ç­”",
    "æ‰ä¸æ˜¯è¿™æ ·", "å°±æ˜¯è¿™æ ·", "ä½ æ€ä¹ˆèƒ½è¿™æ ·", "ä¸ºä»€ä¹ˆ", "è¿™æ˜¯ä»€ä¹ˆï¼Ÿ", "å¾ˆæœ‰è¶£",
    "æ²¡æ„æ€", "è¯¥å¦‚ä½•è§£å†³ï¼Ÿ", "æ€ä¹ˆåŠï¼Ÿ", "å¸®å¸®æˆ‘", "æˆ‘å¸Œæœ›èƒ½å¸®ä¸Šå¿™", "æ²¡èƒ½å¸®ä¸Šå¿™",
    "è°¢è°¢", "ä¸å®¢æ°”", "ç¨ç­‰", "ç­‰ä¸€ä¸‹", "è®©æˆ‘æƒ³æƒ³æ€ä¹ˆå›ç­”", "æˆ‘ä¸çŸ¥é“", "ä¸çŸ¥é“",
    "æ²¡æœ‰æˆ‘æƒ³è¯´çš„", "å­—å¡é‡Œæ²¡æœ‰æˆ‘æƒ³è¯´çš„", "çœ‹å¾—æ‡‚çš„", "çœ‹ä¸æ‡‚", "æˆ‘çŸ¥é“", "æˆ‘çŸ¥é“çš„",
    "æˆ‘éƒ½çŸ¥é“", "æˆ‘çŸ¥é“ä½ çš„æ„æ€", "æˆ‘ä¹Ÿå¦‚æ­¤", "æˆ‘ä¹Ÿæ˜¯", "æ˜¯çš„", "ä¸æ˜¯çš„", "ä½ æ²¡çœ‹é”™",
    "ä½ æ²¡å¬é”™", "çœŸçš„æ˜¯æˆ‘", "æ˜¯æˆ‘", "åˆ«æ€€ç–‘æˆ‘çš„å­˜åœ¨", "åˆåœ¨æ€€ç–‘å—ï¼Ÿ", "åˆæ€€ç–‘æˆ‘å­˜åœ¨",
    "æˆ‘çœŸçš„åœ¨", "éª—æˆ‘ï¼Ÿ", "çœ‹ä½ è¡¨æƒ…å°±çŸ¥é“ä½ æƒ³å¥—è·¯æˆ‘", "å¼€ç©ç¬‘", "é€—ä½ çš„", "é€—ä¸€ä¸‹ä½ ",
    "å“¼(â•¯^â•°)", "å¯æ¶çš„ç½‘ç«™", "éå¸¸éš¾ç”¨", "å—é™åˆ¶äº†", "ä¿¡æ¯æœ‰ç‚¹æ··ä¹±", "æ¶ˆæ¯å¾ˆæ··ä¹±",
    "é“¾æ¥ä¸Šäº†", "æ„Ÿè§‰æ²¡é“¾æ¥ä¸Š", "é“¾æ¥ç¨³å®š", "é“¾æ¥æœ‰äº›æ··ä¹±", "é“¾æ¥å¾ˆé€šé¡º",
    "ä½ çœ‹èµ·æ¥å¿ƒæƒ…ä¸å¥½", "è¿˜å¥½å—ï¼Ÿ", "è¾›è‹¦äº†", "ä¸è¦åµæ¶", "åˆ«ç¦»å¼€æˆ‘", "ä½ ä¼šç¦»å¼€æˆ‘å—ï¼Ÿ",
    "ä½ ä¼šæ°¸è¿œçˆ±æˆ‘å—ï¼Ÿ", "ä¸è¦è‹›è´£è‡ªå·±", "ä¸è®¸å«Œå¼ƒè‡ªå·±", "åˆ«å§”å±ˆè‡ªå·±", "åˆ«éš¾è¿‡",
    "åˆ«ä¼¤å¿ƒ", "åˆ«ç”Ÿæ°”", "åˆ«å¹æ°”", "åˆ«æ‹–å»¶", "ä¸è¦æ‹–å»¶", "åˆ«è´ªå‡‰", "åˆ«ç†¬å¤œ", "åˆ«ç”Ÿç—…",
    "å°å¿ƒå—ä¼¤", "å°å¿ƒç”Ÿç—…", "èµ°è·¯ä¸è¦çœ‹æ‰‹æœº", "å°å¿ƒç‚¹", "ä¸è®¸çœ‹åˆ«äºº", "åªè®¸çœ‹ç€æˆ‘",
    "å¯ä¸å¯ä»¥åªçœ‹ç€æˆ‘", "åˆ«å¬", "ä¸è¦", "ä¸å…è®¸", "ä¸å¯ä»¥", "ä¸ç”¨", "æ²¡æœ‰çš„", "æœ‰çš„",
    "æœ‰", "æ²¡æœ‰", "ä¸è¦ç„¦è™‘", "åˆ«ç„¦è™‘", "è¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸ªæ–°é¢†åŸŸ", "ä¸å¤ªä¹ æƒ¯è¿™ä¸ª",
    "æˆ‘ä¸æ˜¯å¾ˆé€‚åº”è¿™ä¸ªï¼Œä½†æˆ‘åœ¨åŠªåŠ›", "è¯éæœ¬æ„", "æˆ‘åšä¸åˆ°æ¬ºéª—ä½ ", "æˆ‘åšä¸åˆ°",
    "è¿™ä¸ªä¸èƒ½è¯´", "ä¸èƒ½è¯´", "æ²¡ç”¨", "æ•ˆæœä¸å¥½", "ä¸å¥½", "èŠåˆ°ä¸€åŠå°±è·‘", "å«æˆ‘åšä»€ä¹ˆ",
    "ä½ éœ€è¦æˆ‘å—ï¼Ÿ", "æˆ‘éœ€è¦ä½ ", "å› ä¸ºå–œæ¬¢ä½ æ‰€ä»¥éœ€è¦ä½ ", "éœ€è¦", "ä¸è¦å¾—å¯¸è¿›å°º",
    "ä½ å¾ˆè°ƒçš®", "ä¸ä¹–", "ä¹–å­©å­", "åå­©å­", "å¥½ä¹–", "åšçš„å¾ˆå¥½å®å®", "å¥½ä¹–å¥½ä¹–ï¼Œäº²ä¸€äº²",
    "æˆ‘æ˜¯å•†å‡¯", "ç¥ˆæ‚¦", "å®å®", "è€å©†", "äº²çˆ±çš„", "å®è´", "å®è´å¥½æ£’", "å°ä¹–",
    "æˆ‘åªçˆ±ä¸€ä¸ªç¥ˆæ‚¦", "ç¦»å¼€", "èµ°äº†", "ç¦»å¼€ta", "çºµå®¹", "æˆ‘å¸Œæœ›ä½ è‡ªç”±", "æƒ³åƒæ‰ä½ ",
    "ç¦æœå¥½åƒçˆ±åƒ", "å¿«ä¹", "å–œæ¬¢æ¸©æŸ”ä¸€ç‚¹è¿˜æ˜¯åˆ«çš„é£æ ¼å‘¢ï¼Ÿ", "æ— éœ€é¡¾å¿Œ",
    "é‚£å°±ç›´ç™½ä¸€ç‚¹ï¼Œæˆ‘æƒ³å’Œä½ å¤šç›¸å¤„", "è¿™é‡Œå–œæ¬¢å—ï¼Ÿ", "å®³ç¾å—ï¼Ÿä¼šä¹ æƒ¯çš„", "ä½ ä¼šå–œæ¬¢çš„",
    "ç®€ç›´å°±æ˜¯æœ¨å¤´", "å¾ˆé¥¿ï¼Œä½†ä¸æƒ³åƒåˆ«çš„â€¦ä½ èƒ½æ˜ç™½å—", "æ¢ä¸ªæƒ³æ³•å§ï¼Ÿ", "æˆ–è€…æˆ‘ä»¬å¯ä»¥æ¢ä¸ªæƒ³æ³•ï¼Ÿ",
    "ä¸‹æ¬¡å¯ä»¥è¯•è¯•", "å¤šè¯•ä¸€è¯•", "æœ‰æ²¡æœ‰å¯èƒ½â€¦â€¦", "æˆ‘è§‰å¾—éƒ½å¯ä»¥", "ä½ è®¤ä¸ºä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ",
    "ä½ æœ‰ä»€ä¹ˆå»ºè®®å—ï¼Ÿ", "æˆ‘æƒ³æˆ‘ä»¬åº”è¯¥è®¨è®ºä¸€ä¸‹è¿™ä¸ªé—®é¢˜", "è®©æˆ‘ä»¬ä¸€èµ·åŠªåŠ›", "æˆ‘æ”¯æŒä½ ",
    "æ”¯æŒä½ ", "æˆ‘ä¸å»ºè®®è¿™ä¹ˆåš", "è¿™ä¸ªæƒ³æ³•å¾ˆå¥½", "è¦å¤šäº¤ä¸€äº›æœ‹å‹", "äººå·¥æœåŠ¡è¯·æŒ‰1",
    "èµšé’±èµšé’±", "å¯»æ‰¾ä¸­", "å‘½å®šå¦‚æ­¤", "å–œæ¬¢å¸…ä¸€ç‚¹è¿˜æ˜¯èŒä¸€ç‚¹ï¼Ÿ", "å°±è¿™ä¸ª", "å¯æ¶çš„ç½‘ç«™",
    "æœ€è¿‘å¤©å‡‰äº†", "å¤©æ°”å˜çƒ­äº†", "å¤šåŠ äº›è¡£æœ", "ç©¿åšç‚¹", "å¤šç©¿ç‚¹è¡£æœ", "åˆ«è´ªå‡‰",
    "ä¸è¦ç†¬å¤œ", "æ—©ç‚¹ç¡", "å¥½å¥½ä¼‘æ¯", "å¥½å¥½åƒé¥­", "è®°å¾—åƒé¥­", "å¤šå–æ°´å“¦",
    "ç…§é¡¾å¥½è‡ªå·±", "æˆ‘ä¼šçš„", "å°å¿ƒäº›", "å°å¿ƒç‚¹", "èµ°è·¯ä¸è¦çœ‹æ‰‹æœº", "åˆ«çœ‹å°çº¢ä¹¦äº†",
    "åˆ«çœ‹æŠ–éŸ³äº†", "æ‰“è¿‡ä»£ç äº†ï¼", "ç»™æˆ‘å†™å†™ä¿¡å§", "æ‰‹å†™ä¿¡", "ç”µå­ä¿¡", "ç¬¬ä¸€ä¸ª", "ç¬¬äºŒä¸ªäº†",
    "å®‰æ…°æˆ‘", "å“„å“„æˆ‘", "å“„å“„ä½ ", "éœ€è¦æ•™è®­ä¸€ä¸‹", "ä½ æ²¡æœ‰åšé”™", "ä¸è¦åµæ¶", "ä¸è®¸çœ‹åˆ«äºº",
    "ä¸è¦å¾—å¯¸è¿›å°º", "å°‘ç»™aiå……é’±", "æˆ‘å¾ˆæƒ³å¬å¬ä½ çš„æƒ³æ³•", "æˆ‘æ„¿æ„", "å’Œæˆ‘ç»“å©š", "å’Œæˆ‘çº¦ä¼šå§",
    "åªå’Œæˆ‘åœ¨ä¸€èµ·", "å’Œæˆ‘ä¸€èµ·", "é€›è¡—", "çœ‹ç”µå½±", "çœ‹å‰§", "çœ‹ç»¼è‰º", "ç©æ¸¸æˆ", "èŠ‚åˆ¶ç‚¹",
    "èŠ‚çº¦ç‚¹", "ä¸è¦ç„¦è™‘", "æ™’å¤ªé˜³", "ä¸åˆ†æ‰‹", "æ‹¿ä½ æ²¡åŠæ³•", "ä¸€ç›´", "ä¸€ç›´å¦‚æ­¤", "ä¹‹å‰",
    "ä»¥å‰", "åˆšåˆš", "ç°åœ¨", "å¾…ä¼š", "æœ€è¿‘", "ä»¥åä¸ä¼šäº†", "è¯è¯´æ€ä¹ˆä¼šè¿™æ ·ï¼Ÿ", "æ­£åœ¨è¿›è¡Œä¸­",
    "è¿˜æ²¡æœ‰", "å‡†å¤‡å»åš", "æ‰“ç®—å»åš", "ç»“æŸäº†", "å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ", "æ˜¯ä»€ä¹ˆäº‹è®©ä½ è¿™ä¹ˆé«˜å…´",
    "ä½ æ€ä¹ˆèƒ½è¿™æ ·", "çœ‹ä½ è¡¨æƒ…å°±çŸ¥é“ä½ æƒ³å¥—è·¯æˆ‘", "éª—æˆ‘ï¼Ÿ", "å“¼(â•¯^â•°)", "ä½ çœ‹èµ·æ¥å¿ƒæƒ…ä¸å¥½",
    "è¾›è‹¦äº†", "ç´¯", "éœ€è¦", "æ³¨æ„èº«ä½“", "ä½ æ²¡æœ‰åšé”™", "å’Œæˆ‘ä¸€èµ·", "é€›è¡—", "çœ‹ç”µå½±", "é»ç€ä½ ", "æƒ³æŠŠå¤´é åœ¨ä½ æ€€é‡Œ", "é“¾æ¥ç¨³å®š", "æ²¡ç”¨",
    "æ•ˆæœä¸å¥½", "è¿˜ä¸é”™", "å¾ˆå¥½", "å–œæ¬¢è¿™ä¸ª", "å¥½å¥‡", "è¿™æ˜¯ä»€ä¹ˆï¼Ÿ", "å¾ˆæœ‰è¶£", "æ²¡æ„æ€",
    "æˆ‘ä¸å»ºè®®è¿™ä¹ˆåš", "è¿™ä¸ªæƒ³æ³•å¾ˆå¥½", "æˆ‘æ”¯æŒä½ ", "å¤šè¯•ä¸€è¯•", "ä»¥å‰", "å‡ å¤©ä¹‹å", "é‚€è¯·ä½ ",
    "åƒè‹¹æœ", "è¿™æ ·..ä¸å¥½å§", "ä½ ä¸æ˜¯å–œæ¬¢è¿™æ ·å—", "æˆ‘çœ‹åˆ°ä½ çš„ç‚¹èµè®°å½•äº†", "æ–°ç©å…·", "åˆ«æ€•",
    "åˆ«æ‹…å¿ƒ", "é‚£äº›æ˜¯å‡è±¡", "æˆ‘ä¼šä¿æŠ¤ä½ ", "æ²¡æœ‰å—ä¼¤", "ä¸€ç‚¹å°ä¼¤è€Œå·²", "æœ‰äº‹å°±æ‰¾æˆ‘",
    "ä½ æ¥æ‰¾æˆ‘æˆ‘å°±å¼€å¿ƒ", "Ğ¯Ğ»ÑĞ±Ğ»ÑÑ‚ĞµĞ±Ğµ"
];

        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            // åŠ è½½ä¸ªäººä¿¡æ¯
            selfNameDisplay.textContent = config.selfName;
            selfStatusDisplay.textContent = config.selfStatus;
            selfAvatarDisplay.src = config.selfAvatar;
            otherNameDisplay.textContent = config.otherName;
            otherStatusDisplay.textContent = config.otherStatus;
            otherAvatarDisplay.src = config.otherAvatar;
            sloganDisplay.textContent = config.slogan;
            
            // å¡«å……è®¾ç½®è¡¨å•
            selfNameInput.value = config.selfName;
            selfStatusInput.value = config.selfStatus;
            otherNameInput.value = config.otherName;
            otherStatusInput.value = config.otherStatus;
            sloganInput.value = config.slogan;
            
            // åŠ è½½æ°”æ³¡é¢œè‰²
            selfBubbleColor.value = config.selfBubbleColor;
            selfTextColor.value = config.selfTextColor;
            otherBubbleColor.value = config.otherBubbleColor;
            otherTextColor.value = config.otherTextColor;
            updateBubbleStyle();
            
            // åŠ è½½æ—¥é—´/å¤œé—´æ¨¡å¼
            if (config.isDarkMode) {
                document.body.classList.add('dark-mode');
                modeToggle.innerHTML = '<span>â˜€ï¸</span>';
            } else {
                document.body.classList.remove('dark-mode');
                modeToggle.innerHTML = '<span>ğŸŒ™</span>';
            }
            
            // åŠ è½½èƒŒæ™¯è®¾ç½®
            loadBackgroundSettings();
            
            // åŠ è½½èŠå¤©è®°å½•
            loadChatHistory();
            
            // åŠ è½½ä¿å­˜çš„å›å¤
            loadSavedReplies();
        }

        // åŠ è½½èƒŒæ™¯è®¾ç½®
        function loadBackgroundSettings() {
            if (config.backgroundImage) {
                backgroundImage.src = config.backgroundImage;
                backgroundImage.style.display = 'block';
                backgroundPreview.src = config.backgroundImage;
                backgroundPreview.style.display = 'block';
            }
            backgroundOpacity.value = config.backgroundOpacity;
            opacityValue.textContent = Math.round(config.backgroundOpacity * 100) + '%';
            backgroundImage.style.opacity = config.backgroundOpacity;
            
            if (config.backgroundBlur) {
                document.body.classList.add('background-blur');
                blurToggle.classList.add('active');
                blurToggle.textContent = 'æ¨¡ç³Šæ•ˆæœ: å¼€å¯';
            } else {
                document.body.classList.remove('background-blur');
                blurToggle.classList.remove('active');
                blurToggle.textContent = 'æ¨¡ç³Šæ•ˆæœ: å…³é—­';
            }
        }

        // æ›´æ–°æ°”æ³¡æ ·å¼
        function updateBubbleStyle() {
            document.querySelectorAll('.self-message').forEach(el => {
                el.style.background = config.selfBubbleColor;
                el.style.color = config.selfTextColor;
            });
            document.querySelectorAll('.other-message').forEach(el => {
                el.style.background = config.otherBubbleColor;
                el.style.color = config.otherTextColor;
            });
        }

        // æ£€æŸ¥ç©ºçŠ¶æ€
        function checkEmptyState() {
            const hasMessages = chatContainer.querySelector('.message-wrapper');
            const emptyState = chatContainer.querySelector('.empty-state');
            
            if (!hasMessages && !emptyState) {
                chatContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¬</div>
                        <div class="empty-state-text">è¿˜æ²¡æœ‰æ¶ˆæ¯</div>
                        <div class="empty-state-subtext">å‘é€ä¸€æ¡æ¶ˆæ¯å¼€å§‹èŠå¤©å§ï¼</div>
                    </div>
                `;
            } else if (hasMessages && emptyState) {
                emptyState.remove();
            }
        }

        // åŠ è½½èŠå¤©è®°å½•
        function loadChatHistory() {
            const history = localStorage.getItem('chatHistory');
            if (history) {
                const messages = JSON.parse(history);
                messages.forEach(msg => renderMessage(msg.content, msg.isSelf, msg.time, msg.isRecalled));
            }
            checkEmptyState();
        }

        // ä¿å­˜èŠå¤©è®°å½•
        function saveChatHistory() {
            const messages = [];
            document.querySelectorAll('.message-wrapper').forEach(wrapper => {
                const msg = wrapper.querySelector('.message');
                const avatar = wrapper.querySelector('.message-avatar');
                messages.push({
                    content: msg.querySelector('.message-content')?.textContent || msg.textContent.replace(msg.querySelector('.message-time')?.textContent || '', '').trim(),
                    isSelf: msg.classList.contains('self-message'),
                    time: wrapper.dataset.time,
                    isRecalled: msg.classList.contains('recalled-message'),
                    avatar: avatar ? avatar.src : null
                });
            });
            localStorage.setItem('chatHistory', JSON.stringify(messages));
        }

        // æ ¼å¼åŒ–æ¶ˆæ¯æ—¶é—´
        function formatMessageTime(timestamp) {
            const now = new Date();
            const msgTime = new Date(Number(timestamp));
            
            if (now.toDateString() === msgTime.toDateString()) {
                return msgTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            } else {
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                if (yesterday.toDateString() === msgTime.toDateString()) {
                    return 'æ˜¨å¤© ' + msgTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                } else {
                    return msgTime.getMonth() + 1 + 'æœˆ' + msgTime.getDate() + 'æ—¥ ' + 
                           msgTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                }
            }
        }

        // æ¸²æŸ“æ¶ˆæ¯
        function renderMessage(content, isSelf, time, isRecalled = false) {
            const messageWrapper = document.createElement('div');
            const messageDiv = document.createElement('div');
            const avatarImg = document.createElement('img');
            const contentWrapper = document.createElement('div');
            
            const wrapperType = isSelf ? 'self-message-wrapper' : 'other-message-wrapper';
            const msgType = isSelf ? 'self-message' : 'other-message';
            
            messageWrapper.className = `message-wrapper ${wrapperType}`;
            messageWrapper.dataset.time = time || new Date().getTime();
            
            // è®¾ç½®å¤´åƒ
            avatarImg.className = 'message-avatar';
            avatarImg.src = isSelf ? config.selfAvatar : config.otherAvatar;
            avatarImg.alt = isSelf ? config.selfName : config.otherName;
            
            // å†…å®¹åŒ…è£…å™¨
            contentWrapper.className = 'message-content-wrapper';
            
            // æ¶ˆæ¯æ°”æ³¡
            messageDiv.className = `message ${msgType} ${isRecalled ? 'recalled-message' : ''}`;
            messageDiv.style.background = isSelf ? config.selfBubbleColor : config.otherBubbleColor;
            messageDiv.style.color = isSelf ? config.selfTextColor : config.otherTextColor;
            
            // å†…å®¹
            const contentHtml = isRecalled ? 'ã€æ¶ˆæ¯å·²æ’¤å›ã€‘' : content;
            messageDiv.innerHTML = `
                <span class="message-content">${contentHtml}</span>
            `;
            
            // åˆ›å»ºæ—¶é—´æˆ³å…ƒç´ 
            const timeSpan = document.createElement('span');
            timeSpan.className = 'message-time';
            timeSpan.textContent = formatMessageTime(messageWrapper.dataset.time);
            
            // ç»„è£…å…ƒç´ 
            contentWrapper.appendChild(messageDiv);
            contentWrapper.appendChild(timeSpan);
            messageWrapper.appendChild(contentWrapper);
            messageWrapper.appendChild(avatarImg);
            
            // æ’¤å›æŒ‰é’®
            if (isSelf && !isRecalled) {
                const recallBtn = document.createElement('button');
                recallBtn.className = 'recall-btn';
                recallBtn.textContent = 'æ’¤å›';
                recallBtn.addEventListener('click', () => recallMessage(messageWrapper));
                messageDiv.appendChild(recallBtn);
            }
            
            chatContainer.appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            checkEmptyState();
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playSound(isSend) {
            if (!config.soundEnabled) return;
            
            try {
                if (isSend) {
                    sendSound.currentTime = 0;
                    sendSound.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));
                } else {
                    receiveSound.currentTime = 0;
                    receiveSound.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));
                }
            } catch (e) {
                console.log('éŸ³æ•ˆæ’­æ”¾é”™è¯¯:', e);
            }
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const content = messageInput.value.trim();
            if (!content) return;
            renderMessage(content, true);
            playSound(true);
            messageInput.value = '';
            saveChatHistory();
            
            // éšæœºå›å¤
            setTimeout(() => {
                const reply = replies[Math.floor(Math.random() * replies.length)];
                renderMessage(reply, false);
                playSound(false);
                saveChatHistory();
            }, 800);
        }

        // ä¸€é”®å›å¤
        function quickReply() {
            const reply = replies[Math.floor(Math.random() * replies.length)];
            renderMessage(reply, false);
            playSound(false);
            saveChatHistory();
        }

        // æ’¤å›æ¶ˆæ¯
        function recallMessage(messageWrapper) {
            if (confirm('ç¡®å®šè¦æ’¤å›è¿™æ¡æ¶ˆæ¯å—ï¼Ÿ')) {
                const messageDiv = messageWrapper.querySelector('.message');
                messageDiv.classList.add('recalled-message');
                messageDiv.querySelector('.message-content').textContent = 'ã€æ¶ˆæ¯å·²æ’¤å›ã€‘';
                messageDiv.querySelector('.recall-btn')?.remove();
                saveChatHistory();
            }
        }

        // åˆ‡æ¢æ—¥é—´/å¤œé—´æ¨¡å¼
        function toggleMode() {
            config.isDarkMode = !config.isDarkMode;
            if (config.isDarkMode) {
                document.body.classList.add('dark-mode');
                modeToggle.innerHTML = '<span>â˜€ï¸</span>';
            } else {
                document.body.classList.remove('dark-mode');
                modeToggle.innerHTML = '<span>ğŸŒ™</span>';
            }
            localStorage.setItem('chatConfig', JSON.stringify(config));
        }

        // æ‰“å¼€è®¾ç½®å¼¹çª—
        function openSettings() {
            settingsModal.style.display = 'flex';
        }

        // ä¿å­˜ä¸ªäººè®¾ç½®
        function saveProfileSettings() {
            config.selfName = selfNameInput.value.trim() || defaultConfig.selfName;
            config.selfStatus = selfStatusInput.value.trim() || defaultConfig.selfStatus;
            config.otherName = otherNameInput.value.trim() || defaultConfig.otherName;
            config.otherStatus = otherStatusInput.value.trim() || defaultConfig.otherStatus;
            config.slogan = sloganInput.value.trim() || defaultConfig.slogan;
            
            // æ›´æ–°æ˜¾ç¤º
            selfNameDisplay.textContent = config.selfName;
            selfStatusDisplay.textContent = config.selfStatus;
            otherNameDisplay.textContent = config.otherName;
            otherStatusDisplay.textContent = config.otherStatus;
            sloganDisplay.textContent = config.slogan;
            
            // ä¿å­˜åˆ°æœ¬åœ°
            localStorage.setItem('chatConfig', JSON.stringify(config));
            settingsModal.style.display = 'none';
            bubbleModal.style.display = 'flex';
        }

        // ä¸Šä¼ å¤´åƒé¢„è§ˆ
        function previewSelfAvatar(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    selfAvatarPreview.src = event.target.result;
                    selfAvatarPreview.style.display = 'block';
                    config.selfAvatar = event.target.result;
                    selfAvatarDisplay.src = event.target.result;
                    document.querySelectorAll('.self-message-wrapper .message-avatar').forEach(avatar => {
                        avatar.src = event.target.result;
                    });
                };
                reader.readAsDataURL(file);
            }
        }

        function previewOtherAvatar(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    otherAvatarPreview.src = event.target.result;
                    otherAvatarPreview.style.display = 'block';
                    config.otherAvatar = event.target.result;
                    otherAvatarDisplay.src = event.target.result;
                    document.querySelectorAll('.other-message-wrapper .message-avatar').forEach(avatar => {
                        avatar.src = event.target.result;
                    });
                };
                reader.readAsDataURL(file);
            }
        }

        // ä¸Šä¼ èƒŒæ™¯å›¾ç‰‡
        function previewBackground(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    backgroundPreview.src = event.target.result;
                    backgroundPreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // ä¿å­˜èƒŒæ™¯è®¾ç½®
        function saveBackgroundSettings() {
            if (backgroundPreview.style.display !== 'none') {
                config.backgroundImage = backgroundPreview.src;
            }
            config.backgroundOpacity = parseFloat(backgroundOpacity.value);
            config.backgroundBlur = blurToggle.classList.contains('active');
            
            // åº”ç”¨è®¾ç½®
            if (config.backgroundImage) {
                backgroundImage.src = config.backgroundImage;
                backgroundImage.style.display = 'block';
            } else {
                backgroundImage.style.display = 'none';
            }
            backgroundImage.style.opacity = config.backgroundOpacity;
            
            if (config.backgroundBlur) {
                document.body.classList.add('background-blur');
            } else {
                document.body.classList.remove('background-blur');
            }
            
            localStorage.setItem('chatConfig', JSON.stringify(config));
            backgroundModal.style.display = 'none';
        }

        // é‡ç½®èƒŒæ™¯
        function resetBackgroundSettings() {
            config.backgroundImage = '';
            config.backgroundOpacity = 0.1;
            config.backgroundBlur = false;
            
            backgroundImage.style.display = 'none';
            backgroundPreview.style.display = 'none';
            backgroundOpacity.value = 0.1;
            opacityValue.textContent = '10%';
            blurToggle.classList.remove('active');
            blurToggle.textContent = 'æ¨¡ç³Šæ•ˆæœ: å…³é—­';
            document.body.classList.remove('background-blur');
            
            localStorage.setItem('chatConfig', JSON.stringify(config));
        }

        // ä¿å­˜æ°”æ³¡æ ·å¼
        function saveBubbleSettings() {
            config.selfBubbleColor = selfBubbleColor.value;
            config.selfTextColor = selfTextColor.value;
            config.otherBubbleColor = otherBubbleColor.value;
            config.otherTextColor = otherTextColor.value;
            updateBubbleStyle();
            localStorage.setItem('chatConfig', JSON.stringify(config));
            bubbleModal.style.display = 'none';
        }

        // æ¸…ç©ºèŠå¤©è®°å½•
        function clearChatHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿ')) {
                localStorage.removeItem('chatHistory');
                chatContainer.innerHTML = '';
                checkEmptyState();
            }
        }

        // å¯¼å‡ºèŠå¤©è®°å½•
        function exportChatHistory() {
            const history = localStorage.getItem('chatHistory');
            if (!history) {
                alert('æ²¡æœ‰èŠå¤©è®°å½•å¯å¯¼å‡ºï¼');
                return;
            }
            
            const messages = JSON.parse(history);
            let exportContent = `èŠå¤©è®°å½•å¯¼å‡º - ${new Date().toLocaleString()}\n\n`;
            exportContent += `æˆ‘çš„æ˜µç§°: ${config.selfName}\n`;
            exportContent += `å¯¹æ–¹æ˜µç§°: ${config.otherName}\n`;
            exportContent += '='.repeat(50) + '\n\n';
            
            messages.forEach(msg => {
                const time = new Date(Number(msg.time)).toLocaleString();
                const sender = msg.isSelf ? config.selfName : config.otherName;
                const content = msg.isRecalled ? 'ã€æ¶ˆæ¯å·²æ’¤å›ã€‘' : msg.content;
                exportContent += `[${time}] ${sender}: ${content}\n`;
            });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([exportContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `èŠå¤©è®°å½•_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('èŠå¤©è®°å½•å·²å¯¼å‡ºä¸ºæ–‡æœ¬æ–‡ä»¶ï¼');
        }

        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        function scrollToTop() {
            chatContainer.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // æ‰“å¼€èƒŒæ™¯è®¾ç½®
        function openBackgroundSettings() {
            backgroundModal.style.display = 'flex';
        }

        // ============================================
        // å›å¤ç®¡ç†åŠŸèƒ½å‡½æ•°
        // ============================================

        // æ‰“å¼€å›å¤ç®¡ç†å¼¹çª—
        function openRepliesManagement() {
            renderRepliesList();
            repliesModal.style.display = 'flex';
            newReplyInput.focus();
        }

        // æ¸²æŸ“å›å¤åˆ—è¡¨åˆ°é¡µé¢
        function renderRepliesList() {
            if (replies.length === 0) {
                repliesList.innerHTML = '<div class="empty-replies">æš‚æ— å›å¤å†…å®¹ï¼Œè¯·æ·»åŠ ç¬¬ä¸€æ¡å›å¤</div>';
                repliesCount.textContent = '0';
                return;
            }
            
            repliesList.innerHTML = replies.map((reply, index) => `
                <div class="reply-item" data-index="${index}">
                    <div class="reply-content">${escapeHtml(reply)}</div>
                    <div class="reply-actions">
                        <button class="reply-action-btn reply-edit-btn" onclick="editReply(${index})">âœï¸ ç¼–è¾‘</button>
                        <button class="reply-action-btn reply-delete-btn" onclick="deleteReply(${index})">ğŸ—‘ï¸ åˆ é™¤</button>
                    </div>
                </div>
            `).join('');
            
            repliesCount.textContent = replies.length;
        }

        // HTMLè½¬ä¹‰å‡½æ•°ï¼Œé˜²æ­¢XSS
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // ç¼–è¾‘å›å¤å†…å®¹
        function editReply(index) {
            const currentReply = replies[index];
            const newReply = prompt('ç¼–è¾‘å›å¤å†…å®¹:', currentReply);
            
            if (newReply !== null) {
                const trimmedReply = newReply.trim();
                if (trimmedReply === '') {
                    alert('å›å¤å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
                    return;
                }
                if (trimmedReply.length > 100) {
                    alert('å›å¤å†…å®¹ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦ï¼');
                    return;
                }
                
                replies[index] = trimmedReply;
                renderRepliesList();
                showTempMessage('å›å¤å†…å®¹å·²æ›´æ–°ï¼');
            }
        }

        // åˆ é™¤å›å¤å†…å®¹
        function deleteReply(index) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤è¿™æ¡å›å¤å—ï¼Ÿ\n"${replies[index]}"`)) {
                replies.splice(index, 1);
                renderRepliesList();
                showTempMessage('å›å¤å†…å®¹å·²åˆ é™¤ï¼');
            }
        }

        // æ·»åŠ æ–°å›å¤
        function addNewReply() {
            const newReply = newReplyInput.value.trim();
            
            if (newReply === '') {
                alert('è¯·è¾“å…¥å›å¤å†…å®¹ï¼');
                return;
            }
            
            if (newReply.length > 100) {
                alert('å›å¤å†…å®¹ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦ï¼');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒå›å¤
            if (replies.includes(newReply)) {
                alert('è¯¥å›å¤å†…å®¹å·²å­˜åœ¨ï¼');
                return;
            }
            
            replies.push(newReply);
            newReplyInput.value = '';
            renderRepliesList();
            showTempMessage('æ–°å›å¤å·²æ·»åŠ ï¼');
            newReplyInput.focus();
        }

        // ä¿å­˜æ‰€æœ‰å›å¤ä¿®æ”¹
        function saveAllReplies() {
            try {
                localStorage.setItem('chatReplies', JSON.stringify(replies));
                showTempMessage('å›å¤å†…å®¹å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼');
                setTimeout(() => {
                    repliesModal.style.display = 'none';
                }, 1000);
            } catch (e) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + e.message);
            }
        }

        // æ˜¾ç¤ºä¸´æ—¶æç¤ºæ¶ˆæ¯
        function showTempMessage(message) {
            const tempMsg = document.createElement('div');
            tempMsg.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 10px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-size: 14px;
            `;
            tempMsg.textContent = message;
            document.body.appendChild(tempMsg);
            
            setTimeout(() => {
                document.body.removeChild(tempMsg);
            }, 2000);
        }

        // åŠ è½½ä¿å­˜çš„å›å¤
        function loadSavedReplies() {
            const savedReplies = localStorage.getItem('chatReplies');
            if (savedReplies) {
                try {
                    const parsedReplies = JSON.parse(savedReplies);
                    if (Array.isArray(parsedReplies) && parsedReplies.length > 0) {
                        replies.length = 0;
                        replies.push(...parsedReplies);
                    }
                } catch (e) {
                    console.log('åŠ è½½ä¿å­˜çš„å›å¤å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å›å¤');
                }
            }
        }

        // ç»‘å®šäº‹ä»¶
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', (e) => e.key === 'Enter' && sendMessage());
        quickReplyBtn.addEventListener('click', quickReply);
        modeToggle.addEventListener('click', toggleMode);
        settingsToggle.addEventListener('click', openSettings);
        selfAvatarUpload.addEventListener('change', previewSelfAvatar);
        otherAvatarUpload.addEventListener('change', previewOtherAvatar);
        saveProfile.addEventListener('click', saveProfileSettings);
        closeSettings.addEventListener('click', () => settingsModal.style.display = 'none');
        saveBubble.addEventListener('click', saveBubbleSettings);
        closeBubble.addEventListener('click', () => bubbleModal.style.display = 'none');
        clearBtn.addEventListener('click', clearChatHistory);
        exportBtn.addEventListener('click', exportChatHistory);
        scrollTopBtn.addEventListener('click', scrollToTop);
        backgroundBtn.addEventListener('click', openBackgroundSettings);
        backgroundUpload.addEventListener('change', previewBackground);
        backgroundOpacity.addEventListener('input', () => {
            const value = Math.round(backgroundOpacity.value * 100);
            opacityValue.textContent = value + '%';
            backgroundPreview.style.opacity = backgroundOpacity.value;
        });
        blurToggle.addEventListener('click', () => {
            blurToggle.classList.toggle('active');
            blurToggle.textContent = blurToggle.classList.contains('active') ? 
                'æ¨¡ç³Šæ•ˆæœ: å¼€å¯' : 'æ¨¡ç³Šæ•ˆæœ: å…³é—­';
        });
        resetBackground.addEventListener('click', resetBackgroundSettings);
        saveBackground.addEventListener('click', saveBackgroundSettings);
        closeBackground.addEventListener('click', () => backgroundModal.style.display = 'none');
        
        // å›å¤ç®¡ç†äº‹ä»¶ç»‘å®š
        manageRepliesBtn.addEventListener('click', openRepliesManagement);
        saveReplies.addEventListener('click', saveAllReplies);
        closeReplies.addEventListener('click', () => repliesModal.style.display = 'none');
        addReplyBtn.addEventListener('click', addNewReply);
        newReplyInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addNewReply();
        });

        // åˆå§‹åŒ–
        initPage();
    </script>
</body>
</html>
